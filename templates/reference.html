<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDO Reference Config - {{ config_name if config_name else 'Not Found' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ace Editor -->
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-min-noconflict/ace.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-min-noconflict/ext-language_tools.js"></script>
    <style>
        /* Simplified layout for reference view */
        .reference-view {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .reference-header {
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .reference-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .reference-header-left i {
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .reference-header-left h1 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .reference-header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .reference-header-right a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }
        
        .reference-header-right a:hover {
            color: var(--primary-color);
        }
        
        .reference-main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .reference-editor-container {
            flex: 1;
            position: relative;
        }
        
        .reference-editor-container .editor-tabs {
            display: none; /* Hide tabs in reference view */
        }
        
        #reference-editor {
            width: 100%;
            height: 100%;
        }
        
        .reference-sidebar {
            width: 320px;
            background: var(--bg-surface);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .reference-sidebar-header {
            padding: 16px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
        }
        
        .reference-sidebar-header h2 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .reference-sidebar-header h2 i {
            color: var(--primary-color);
        }
        
        .reference-info-section {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .reference-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .reference-info-item:last-child {
            border-bottom: none;
        }
        
        .reference-info-label {
            color: var(--text-secondary);
        }
        
        .reference-info-value {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .reference-actions {
            padding: 16px;
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }
        
        .reference-actions .btn {
            width: 100%;
            margin-bottom: 8px;
        }
        
        .reference-actions .btn:last-child {
            margin-bottom: 0;
        }
        
        .reference-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            padding: 20px;
        }
        
        .reference-error i {
            font-size: 48px;
            color: var(--error-color);
            margin-bottom: 16px;
        }
        
        .reference-error h2 {
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .reference-error p {
            color: var(--text-secondary);
        }
        
        .download-section {
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }
        
        .download-section h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .download-section h3 i {
            color: var(--accent-color);
        }
    </style>
</head>
<body data-theme="arctic">
    {% if error %}
    <div class="reference-error">
        <i class="fas fa-exclamation-triangle"></i>
        <h2>Reference Config Not Found</h2>
        <p>{{ error }}</p>
        <a href="/" class="btn btn-primary" style="margin-top: 20px;">
            <i class="fas fa-arrow-left"></i> Back to Configurator
        </a>
    </div>
    {% else %}
    <div class="reference-view">
        <!-- Header -->
        <div class="reference-header">
            <div class="reference-header-left">
                <i class="fas fa-book"></i>
                <h1>LDO Reference Config</h1>
            </div>
            <div class="reference-header-right">
                <span style="color: var(--text-secondary); font-size: 13px;">
                    {{ config_name }}
                </span>
                <a href="/" target="_blank">
                    <i class="fas fa-external-link-alt"></i>
                    Open Configurator
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="reference-main">
            <!-- Editor -->
            <div class="reference-editor-container">
                <div id="reference-editor"></div>
            </div>
            
            <!-- Sidebar -->
            <div class="reference-sidebar">
                <div class="reference-sidebar-header">
                    <h2><i class="fas fa-info-circle"></i> Configuration Info</h2>
                </div>
                
                <div class="reference-info-section">
                    <div class="reference-info-item">
                        <span class="reference-info-label">Config Name</span>
                        <span class="reference-info-value">{{ config_name }}</span>
                    </div>
                    <div class="reference-info-item">
                        <span class="reference-info-label">Printer</span>
                        <span class="reference-info-value">{{ printer | replace('voron2.4', 'Voron 2.4') | replace('trident', 'Trident') }}</span>
                    </div>
                    <div class="reference-info-item">
                        <span class="reference-info-label">Board</span>
                        <span class="reference-info-value">{{ board | replace('_', ' ') | title }}</span>
                    </div>
                    <div class="reference-info-item">
                        <span class="reference-info-label">Revision</span>
                        <span class="reference-info-value">{{ revision | upper }}</span>
                    </div>
                </div>
                
                <div class="reference-info-section">
                    <div class="reference-info-item" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                        <span class="reference-info-label">Description</span>
                        <span class="reference-info-value" style="font-weight: normal; font-size: 12px; line-height: 1.4;">
                            {{ config_description }}
                        </span>
                    </div>
                </div>
                
                <div class="reference-info-section">
                    <div class="reference-info-item">
                        <span class="reference-info-label">Source</span>
                        <span class="reference-info-value" style="font-size: 11px; word-break: break-all;">
                            LDO GitHub Repository
                        </span>
                    </div>
                </div>
                
                <div class="download-section">
                    <h3><i class="fas fa-download"></i> Download</h3>
                    <button class="btn btn-primary" onclick="downloadConfig()">
                        <i class="fas fa-file-download"></i>
                        Download .cfg
                    </button>
                </div>
                
                <div class="reference-actions">
                    <a href="/" class="btn btn-secondary" style="text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Configurator
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize Ace Editor
        const editor = ace.edit('reference-editor');
        editor.setTheme('ace/theme/tomorrow_night');
        
        // Use Klipper mode if available, fallback to INI
        try {
            editor.session.setMode('ace/mode/klipper');
        } catch (e) {
            editor.session.setMode('ace/mode/ini');
        }
        
        editor.setOptions({
            fontSize: 14,
            fontFamily: 'JetBrains Mono, Consolas, monospace',
            showLineNumbers: true,
            showGutter: true,
            highlightActiveLine: true,
            highlightSelectedWord: true,
            wrap: true,
            showPrintMargin: false,
            scrollPastEnd: false,
            readOnly: true,  // Read-only for reference configs
            cursorStyle: 'ace',
            animatedScroll: true,
            displayIndentGuides: true,
            fadeFoldWidgets: false,
            showFoldWidgets: true,
        });
        
        // Set the config content
        editor.setValue({{ config_content | tojson }}, -1);
        editor.gotoLine(1);
        
        // Download function
        function downloadConfig() {
            const content = editor.getValue();
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '{{ config_name | replace(" ", "_") | lower }}.cfg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
    {% endif %}
</body>
</html>
